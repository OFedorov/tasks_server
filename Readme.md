# Задание
Необходимо разработать Клиент-серверное приложение.
Сервер.
Занимается приемом и выполнением задач. Выполнение задач производится по очереди по одной за раз.
Предоставляет следующий интерфейс:
1. Получает тип задачи и данные и добавляет задачу в очередь на исполнение. Возвращает идентификатор задачи.
2. По идентификатору возвращает статус задачи (например: в очереди, выполняется, завершено)
3. По идентификатору возвращает результат выполнения задачи (предусмотреть что за результатом могут обратиться несколько раз).

Хранение задач (идентификаторов, данных и результатов) между запусками сервера не требуется.

Список задач (тип) предопределен, для имитации длительности задачи добавить указанную задержку во время ее выполнения:
1. Выполнить разворот строки. (пример -> ремирп). Задержка 2 сек.
2. Выполнить попарно перестановку четных и нечетных символов в строке ( пример -> рпмире, кот -> окт). Задержка 5 сек.


Клиент.
Служит для выполнения запросов к серверу (рекомендуется использовать параметры командной строки).
Должен уметь:
1. Передать данные и тип задачи на сервер, отобразить идентификатор.
2. Запросить и вывести статус задачи по идентификатору.
3. Запросить и вывести результат выполнения задачи по идентификатору.
4. Возможность запуска в режиме, когда клиент отдает задачу на выполнение (данные и тип), дожидается ее выполнения, запрашивает и выводит результат выполнения задачи.

Протокол клиент-серверного взаимодействия на усмотрение разработчика.
Библиотеки и фреймворки на усмотрение разработчика, но предпочтительно использовать встроенные средства питона.
Версия питона (cpython) и ОС на усмотрение разработчика.

# Реализация

# Сервер

Многопоточный сервер принимающий запросы клиентов через сокеты.

## Функции
### Старт задачи
Добавляет задачу в очередь на исполнение. Клиенту возвращает id задачи.
При последующем запросе статуса задачи без разрыва соединения вернет статус задачи по завершению её обработки.

### Статус
Возвращает статус задачи с указанным id. 
При запросе статуса не существующей задачи разрывает соединение с клиентом без ответа.

Возможные статусы:
* "waiting" - Ожидание исполнения
* "success" - Задача успешно выполнена
* "error" - Ошибка во время выполнения задачи
* "execute" - Задача в процессе выполнения

### Результат
Возвращает результат выполнения и статус задачи с указанным id.
При запросе статуса не существующей задачи разрывает соединение с клиентом без ответа.

## Потоки

### Главный поток 
Главный поток (Server.run()) инициализирует поток для исполнения задач (Server._worker_loop()), 
открывает сокет на прием подключений, на каждое новое подключение создает поток для обработки 
сообщений пользователя.

### Поток выполнения задач
Поток ожидает сообщения из очереди. 
При получении сообщение содержащее id задачи совершает попытку его обработки.
Перед запуском статус задачи обновляется на "execute". По завершению, в зависимости от успешности 
исполнения задачи, выставляется статус "success", либо "error".
Задача для исполнения выбирается по запросу пользователя из списка задач формируемого 
на этапе инициализации сервера. 

### Поток обработки входящего сообщения
Данный поток принимает сообщения от пользователя.
В зависимости от типа запроса выполняет одно из трех действий:
* Создает новую задачу и отправляет пользователю её id и статус(по запросу)
* Возвращает статус ранее созданной задачи
* Возвращает результат и статус исполнения задачи

В случае не соблюдения пользователем протокола обмена сообщениями разрывает соединение и завершает поток.

## Запуск сервера

Для запуска сервера можно воспользоваться скриптом run_server.py.
Остановка по команде с клавиатуры ^c.

Для запуска можно воспользоваться следующей командой:

    python3 run_server.py --host localhost --port 4321

Также можно задать дополнительные параметры:

* `--receiving_buffer_size, -r` - размер буфера приема данных (1024 по умолчанию)
* `--connection_limit, -l` - максимум необработанных подключений (1000 по умолчанию)
* `--timeout, -t` - время ожидания данных от пользователя (по умолчанию не заданно)

Для данного сервера определены несколько задач:
* "echo" - возвращает отправленные серверу данные в неизменном виде
* "revers" - разворачивает полученную строку (установленна задержка 2 секунды)
* "permutation" - меняет местами четные и нечетные буквы в полученной строке (установленна задержка 5 секунд)
* "too_long_echo" - возвращает отправленные серверу данные в неизменном виде (установленна задержка 20 секунд)

# Клиент
Взаимодействие с сервером может осуществляться через клиент client.py.

Аргументы:
* `--host` - ip сервера
* `--port` - порт
* `--receiving_buffer_size, -r` - размер принимаемого буфера (по умолчанию 1024)
* `--action, -a` - запрашиваемое у сервера действие. Возможны следующие варианты:
  * `run` - запустить задачу
  * `res` - запросить результат
  * `st` - запросить статус
* `--data, -d` - в зависимости от действия может быть id задачи (при -a [res, st]) либо произвольная строка.
* `-task_name, -n` - имя задачи для запуска на сервере (при -a run)
* `--waiting_for_data, -w` - ожидания результата выполнения задачи

Пример запуска задачи:

    $ python3 client.py --host localhost --port 4321 --action run --task_name revers --data hello --waiting_for_data true
    Result of task [revers]: olleh
    Status: success

    $ python3 client.py --host localhost --port 4321 --action run --task_name revers --data "предложение из нескольких слов" 
    Task [revers] added to the queue. Task id is #4
    $ python3 client.py --host localhost --port 4321 --action st --data 4
    Status of task #4: success
    $ python3 client.py --host localhost --port 4321 --action res --data 4
    Result of task #4: волс хикьлоксен зи еинежолдерп
    Status: success

# Протокол
Для обмена сообщения между клиентом и сервером используется формат json.

## Запросы на сервер
    
Запрос на исполнение задачи:

    {
        "type": "run",
        "task_name": "echo",
        "data": "string of data"
    }

Запрос на получение статуса задачи:

    {
        "type": "status",
        "task_id": 42
    }

Запрос на получение результата:

    {
        "type": "get_result",
        "task_id": 42
    }

## Ответы сервера

Id задачи:

    {
        "task_id": 42
    }

Статус задачи:
    
    {
        "status": "success"
    }

Результат исполнения:

    {
        "status": "waiting"
        "data": None
    }
